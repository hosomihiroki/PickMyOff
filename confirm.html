<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>申請確認 - PickMyOff</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #f4f4f4;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      background: #fff;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 360px;
      text-align: center;
    }
    h1 {
      font-size: 20px;
      margin-bottom: 16px;
    }
    .info {
      margin-bottom: 16px;
      font-size: 16px;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
      margin-bottom: 16px;
    }
    .calendar div {
      padding: 10px;
      border-radius: 6px;
      background: #eee;
      font-size: 14px;
    }
    .calendar .header {
      background: transparent;
      font-weight: bold;
    }
    .calendar .selected {
      background: #007bff;
      color: #fff;
    }
    .calendar .sunday {
      color: red;
    }
    .calendar .saturday {
      color: blue;
    }
    button {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      margin-top: 8px;
      cursor: pointer;
    }
    .submit {
      background: #28a745;
      color: white;
    }
    .back {
      background: #ccc;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>申請確認</h1>
  <div class="info" id="infoText">読み込み中...</div>
  <div class="calendar" id="calendar"></div>
  <button class="submit" onclick="submitRequest()">提出</button>
  <button class="back" onclick="goBack()">戻る</button>
</div>

<script>
  const params = new URLSearchParams(location.search)
  const id = params.get("id") || ""
  const dayList = (params.get("days") || "").split(",").map(n => parseInt(n)).filter(n => !isNaN(n))

  const today = new Date()
  const year = today.getFullYear()
  const month = today.getMonth()
  const weekdays = ["日", "月", "火", "水", "木", "金", "土"]

  document.getElementById("infoText").textContent = `社員番号: ${id}`

  const cal = document.getElementById("calendar")

  // ヘッダー表示
  weekdays.forEach((d, i) => {
    const cell = document.createElement("div")
    cell.textContent = d
    cell.classList.add("header")
    if (i === 0) cell.classList.add("sunday")
    if (i === 6) cell.classList.add("saturday")
    cal.appendChild(cell)
  })

  const firstDay = new Date(year, month, 1).getDay()
  const daysInMonth = new Date(year, month + 1, 0).getDate()

  for (let i = 0; i < firstDay; i++) {
    cal.appendChild(document.createElement("div"))
  }

  for (let day = 1; day <= daysInMonth; day++) {
    const div = document.createElement("div")
    div.textContent = day
    const w = new Date(year, month, day).getDay()
    if (w === 0) div.classList.add("sunday")
    if (w === 6) div.classList.add("saturday")
    if (dayList.includes(day)) div.classList.add("selected")
    cal.appendChild(div)
  }

  function submitRequest() {
    fetch("https://script.google.com/macros/s/AKfycbx1kZWE3VpkmCib-0aM1JjqseFSsU7XMUjubmoT4Q0398XklA8mPX-552nM_JmI2gEHEA/exec", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ id, days: dayList })
    })
    .then(() => {
      alert("申請を送信しました！")
      location.href = "index.html"
    })
    .catch(err => {
      alert("送信失敗: " + err)
    })
  }

  function goBack() {
    location.href = `index.html?id=${encodeURIComponent(id)}&days=${encodeURIComponent(dayList.join(","))}`
  }
</script>
</body>
</html>
